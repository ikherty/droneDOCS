# Рейты (Rates) в Betaflight

Раздел Pid Tuning, вкладка Rateprofile settings.

## Системы рейтов в бетафлайт

Классическая система рейтов Betaflight (была по дефолту до 4.2 включительно) использовала три параметра:

- RC Rate, который возвращает линейную зависимость между положением стика и скоростью; максимальная скорость в град/с при полном отклонении стика в 200 раз превышает значение RC Rate в конфигураторе.
- Super Rate, который экспоненциально увеличивает предыдущую линейную скорость по мере того, как стики удаляются от центра. Он практически не влияет на центральное положение. Точка перегиба кривой не меняется.
  Значение Super Rate = 0,5 удваивает скорость при максимальном отклонении стика.
- RC Expo, которое добавляет вторую кривую поверх предыдущих значений в районе центрального положения стика, и не влияет на максимальную скорость.
  Значение RC Expo = 0,5 в конфигураторе сгладит кривую скорости около центрального положения стика в 2 раза.

Запутанно и не до конца понятно, не правда ли?

Когда мы настраиваем наши рейты, мы в первую очередь заботимся о трех вещах:

- «чувствительность» в центре стика, или насколько «дерганой» будет реакция при отклонениях около центрального значения;
- максимальная скорость вращения при полном отклонении стика, т. е. как быстро ЛА будет вращаться, когда мы делаем флип/ролл;
- насколько быстро изменяется чувствительность, когда мы перемещаем стик от центра до самого края оси, или «точка экспоненциального изгиба».

Несмотря на то, что схема рейтов Betaflight существуют уже давно, она имеет множество недостатков, из-за чего в 4.2 была введена система actual (и еще несколько, использумых другими прошивками, но эта станет основной с 4.3).
Параметры схемы рейтов actual намного понятнее простому пользователю и позволяют менять конкретные значения получаемой кривой без сдвигов в остальном диапазоне.

Поясним параметры:

- Center sensitivity - значение «центральной чувствительности», чтобы напрямую настроить «базовую» линейную реакцию на движение стика. Значение, введенное для «центральной чувствительности», представляет фактическую чувствительность стика в центре в градусах/сек. Введенное число — это «ощущение» центра, которое вы получите при линейной скорости, настроенной на заданное значение град/с. Это своего рода «базовая» отзывчивость.
- Max Rate, чтобы установить желаемую максимальную скорость вращения в градусах/с и сделать «клинообразный» линейный график изменения скорости от центральных значений до максимальной скорости при полном отклонении стика.
- Expo, экспоненциальный коэффициент, который изгибает получаемый интервал между центром и крайним значением.

Тот самый пулл реквест: https://github.com/betaflight/betaflight/pull/9495

**В конечном итоге, рекомендуется использовать actual систему. Все дальнейшие рекомендации будут для нее.**

## Какие рейты лучше всего использовать?

Универсальных рейтов не существует, они подбираются под ваш стиль полета. Можно только уточнить, что для плавных полетов или гонок чаще используются "низкие рейты", для "резкого" фристайла нужны "высокие" рейты. Под низкими предполагается, что Max Rate будет в районе 400-550 град/сек, для высоких Max Rate будет в районе 800-1200, смотря насколько быстро дрон должен совершать обороты при отклонениях стиков.
Center sensitivity многие ставят в диапазоне 70-150. Экспонента подбирается индивидуально. Вы можете менять значения в таблице и смотреть, как меняется график (rates preview) под таблицей, на котором можно представить стик с roll и pitch осями вашей аппаратуры и увидеть, как будет меняться значение при определенном отклонении стика. При включенной аппаратуре можно наблюдать за вращением модели дрона там же.

Касаемо значений по осям (строкам в столбцах), вы можете на все оси поставить одинаковые значения, можете изменить для какой-то оси любой параметр на ваше усмотрение.
Не бойтесь экспериметировать с рейтами, пробуйте менять их (естественно, учтите, что при высоких рейтах дрон будет очень маневренным, а при низких вы скорее всего не успеете сделать флип или ролл на небольшой высоте). Со временем вы станете лучше понимать, какие рейты вам подходят больше. И как говорится, лучшие рейты, это те, на которых вы отлетали 1000 часов:)

## Что еще можно настроить на вкладке с рейтами?

Есть еще 4 параметра: Throttle Limit, Throttle Limit %, Throttle Mid, Throttle Expo. Все они отвечают за работу оси газа.

В случае, если вас устраивает работа стика газа на вашем дроне, вам не следует менять Throttle Limit и его процент. Если вы хотите, чтобы стик газа имел меньший диапазон (актуально в основном для гонщиков) можно указать Throttle Limit = clip и Throttle Limit % на уровне конечного значения газа, и тогда ваш газ от 0 до 100% будет работать в указаном диапазоне. Если вы хотите "придушить", ограничить обороты моторов, можете указать Throttle Limit = scale и Throttle Limit % = 80+-, смотря до какого уровня газа вы хотите ограничить обороты, и тогда от минимального до максимального положения стика газа обороты моторов будут меняться от 0 до указанного Throttle Limit %.

Throttle Mid, Throttle Expo, как правило, необходимы для фристайлеров и синематик пилотов, гонщики стараются не использовать экспоненту на газу, чтобы обороты моторов менялись "линейно". Throttle Mid является уровнем газа, на котором вы бы хотели поставить экпоненту, чтобы получить более плавное изменение оборотов, Throttle Expo как раз отвечает за эту экспоненту. Экспонента на уровне газа висения позволяет проще удерживать дрон в одном положении, а также плавно сажать и плавно взлетать. Вы можете выставить на OSD параметр Throttle position, взлететь на дроне, попробовать зависнуть, и обратить внимание на значение газа, либо по параметру из осд, либо ориентировочно по стику газа. Например, оказалось, что дрон зависает на 30% газа, значит в Throttle Mid можно указать 0.3, а Throttle Expo хватит в диапазоне 0.3-0.4. Сохраните настройки и попробуйте. Не стоит бояться менять эти 4 параметра, хуже дрону вы не сделаете.

## Профили рейтов

Вы можете сделать есколько профилей рейтов и в зависимости от нужного стиля полета переключать их перед/во время полета. Также полезно, если вы планируете дать порулить кому-то, чтобы человек попробовал ваш дрон на удобных для него рейтах, или в случае, если вы обучаете новичка на своем дроне. Смена рейт профиля производится: через осд меню, в которое можно зайти стик командой
([стик команды](https://2.bp.blogspot.com/-6j_FSBSycEI/XLUUY90qklI/AAAAAAAAEug/xsLM5y7Sya8AeYKKshsgWrf7NLs01DSYgCLcBGAs/s1600/StickPositions%2Bcopy.jpg)); в луа скрипте бетафлайт с аппаратуры ([скачать скрипт на аппаратуру можно тут](https://github.com/betaflight/betaflight-tx-lua-scripts/releases)); по тумблеру, если вы настроили это в режиме adjustments (expert mode on, "rate profile selection" в поле "then apply", и естественно надо настроить остальные параметры в этой строке).
Но многие летают и с одним постоянным профилем, вас никто не заставляет использовать несколько, главное, случайно не переключите нужный профиль на другой, который будет скорее всего в дефолтовом значении, если вы ничего не меняли там.

## Рекомендуемые значения рейтов от ikherty(Валентины) для новичков

Чтобы не переруливать и учиться летать на дроне, рекомендую ставить низкие рейты:

(для всех осей)

- Center sensitivity = 70
- Max Rate = 400
- Expo = 0.2
- Throttle Mid = (газ висения, для типовых 5" это 0.3, для тяжелых вупов это 0.4-0.55)
- Throttle Expo = 0.35
